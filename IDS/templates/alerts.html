<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>IDS Alerts</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:#f3f4f6; color:#111827; margin:0; padding:20px; }
    h1 { color:#111827; margin-bottom:8px; }
    .container { max-width:1000px; margin:0 auto; }
    table { width:100%; border-collapse:collapse; background:white; box-shadow:0 4px 12px rgba(0,0,0,0.05); border-radius:8px; overflow:hidden; }
    th, td { padding:12px 14px; text-align:left; border-bottom:1px solid #e5e7eb; font-size:14px; }
    th { background:#f9fafb; color:#374151; font-weight:600; }
    tr.syn { background: linear-gradient(90deg, rgba(239,68,68,0.06), rgba(244,63,94,0.02)); }
    .tag { display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px; font-weight:600; }
    .tag.syn { background:#fee2e2; color:#b91c1c; }
    .no-alerts { padding:28px; text-align:center; color:#6b7280; }
    .meta { margin-bottom:12px; color:#6b7280; font-size:13px; }
    .small { font-size:13px; color:#6b7280; }
  </style>
</head>
<body>
  <div class="container">
    <h1>IDS Alerts</h1>
    <div class="meta">Auto-refreshing every 3 seconds. Showing latest alerts first.</div>

    {% if not alerts %}
      <div class="no-alerts">No alerts logged yet.</div>
    {% else %}
      <table id="alerts-table">
        <thead>
          <tr>
            <th>Time</th>
            <th>Source IP</th>
            <th>Message</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for a in alerts %}
            <tr class="{{ 'syn' if a.is_syn else '' }}">
              <td>{{ a.timestamp }}</td>
              <td>{{ a.ip }}</td>
              <td>{{ a.message }}</td>
              <td>
                {% if a.is_syn %}
                  <span class="tag syn">SYN</span>
                {% else %}
                  <span class="small">—</span>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endif %}
  </div>

  <script>
    // Poll /alerts.json every 3 seconds and update table
    async function fetchAlerts() {
      try {
        const res = await fetch("/alerts.json", { cache: "no-store" });
        if (!res.ok) return;
        const alerts = await res.json();
        const tbody = document.querySelector("#alerts-table tbody");
        if (!tbody) return;

        tbody.innerHTML = ""; // clear
        for (const a of alerts) {
          const tr = document.createElement("tr");
          if (a.is_syn) tr.classList.add("syn");

          const tdTime = document.createElement("td");
          tdTime.textContent = a.timestamp || "-";
          const tdIp = document.createElement("td");
          tdIp.textContent = a.ip || "-";
          const tdMsg = document.createElement("td");
          tdMsg.textContent = a.message || "-";
          const tdStatus = document.createElement("td");
          if (a.is_syn) {
            const span = document.createElement("span");
            span.className = "tag syn";
            span.textContent = "SYN";
            tdStatus.appendChild(span);
          } else {
            const span = document.createElement("span");
            span.className = "small";
            span.textContent = "—";
            tdStatus.appendChild(span);
          }

          tr.appendChild(tdTime);
          tr.appendChild(tdIp);
          tr.appendChild(tdMsg);
          tr.appendChild(tdStatus);
          tbody.appendChild(tr);
        }
      } catch (e) {
        // silent fail; you could add retry/backoff logic
        console.error("Failed to fetch alerts:", e);
      }
    }

    // initial fetch and polling
    fetchAlerts();
    setInterval(fetchAlerts, 3000);
  </script>
</body>
</html>
